# WS-SAM
**Weakly-Supervised Concealed Object Segmentation with SAM-based Pseudo Labeling and Multi-scale Feature Grouping**, NeurIPS 2023

[[Paper](https://proceedings.neurips.cc/paper_files/paper/2023/file/61aa557643ae8709b6a4f41140b2234a-Paper-Conference.pdf)] [[Supplementary material](https://proceedings.neurips.cc/paper_files/paper/2023/file/61aa557643ae8709b6a4f41140b2234a-Supplemental-Conference.pdf)][[Results](https://pan.baidu.com/s/1osvAanBj8cfWx836zVyfrw?pwd=6666)] [[Pretrained models](https://pan.baidu.com/s/1WkRpCccqGNXK647EUDNNJQ?pwd=6666)]

#### Authors
[Chunming He^](https://chunminghe.github.io/), [Kai Li^](http://kailigo.github.io/), [Yachao Zhang](https://yachao-zhang.github.io/), [Guoxia Xu](https://scholar.google.com/citations?user=tfwlUZkAAAAJ&hl=en), [Longxiang Tang](https://scholar.google.com/citations?user=3oMQsq8AAAAJ&hl=en), [Yulun Zhang](https://yulunzhang.com/), [Zhenhua Guo](https://scholar.google.com/citations?user=dbR6bD0AAAAJ&hl=en), [Xiu Li*](https://scholar.google.com/citations?user=Xrh1OIUAAAAJ&hl=en)

---
> **Abstract:** *Weakly-Supervised Concealed Object Segmentation (WSCOS) aims to  segment objects well blended with surrounding environments using sparsely-annotated data for model training. It remains a challenging task since (1) it is hard to distinguish concealed objects from the background due to the intrinsic similarity and (2) the sparsely-annotated training data only provide weak supervision for model learning. In this paper, we propose a new WSCOS method to address these two challenges. To tackle the intrinsic similarity challenge, we design a multi-scale feature grouping module that first groups features at different granularities and then aggregates these grouping results. By grouping similar features together, it encourages segmentation coherence, helping obtain complete segmentation results for both single and multiple-object images.   For the weak supervision challenge, we utilize the recently-proposed vision foundation model, ``\emph{Segment Anything Model (SAM)}'', and use the provided sparse annotations as prompts to generate segmentation masks, which are used to train the model. To alleviate the impact of low-quality segmentation masks, we further propose a series of strategies, including multi-augmentation result ensemble, entropy-based pixel-level weighting, and entropy-based image-level selection. These strategies help provide more reliable supervision to train the segmentation model. We verify the effectiveness of our method on various WSCOS tasks, and experiments demonstrate that our method achieves state-of-the-art performance on these tasks.*
>
> <p align="center">
> <img width="1000" src="Framework.jpg">
> </p>
---

### 1. Prerequisites

> Note that WS-SAM is only tested on Ubuntu OS with the following environments.

- Creating a virtual environment in the terminal: `conda create -n FEDER python=3.8`.
- Installing necessary packages: `pip install -r requirements.txt`

### 2. Downloading Training and Testing Datasets

- Download the [training pseudo mask](https://pan.baidu.com/s/1OXQdRLhP3kond_vWWQLVIQ?pwd=6666) generated by our WS-SAM, where the extraction code is 6666. We provide all pseudo masks to ensure completeness. Feel free to filter out those low-quality masks in the training phase.

- You can find useful training and testing datasets in [this repository](https://github.com/ChunmingHe/awesome-concealed-object-segmentation).




### 3. Training Configuration

- The pretrained model is stored in [Google Drive](https://drive.google.com/file/d/1OmE2vEegPPTB1JZpj2SPA6BQnXqiuD1U/view?usp=share_link). After downloading, please change the file path in the corresponding code.
```bash
python Train.py  --epoch 160  --lr 1e-4  --batchsize 36  --trainsize 36  --train_root YOUR_TRAININGSETPATH  --val_root  YOUR_VALIDATIONSETPATH  --save_path YOUR_CHECKPOINTPATH
```

### 4. Testing Configuration

Our well-trained model is stored in [Baidu Yun](https://pan.baidu.com/s/1WkRpCccqGNXK647EUDNNJQ?pwd=6666). After downloading, please change the file path in the corresponding code.
```bash
python Test.py  --testsize YOUR_IMAGESIZE  --pth_path YOUR_CHECKPOINTPATH  --test_dataset_path  YOUR_TESTINGSETPATH
```

### 5. Evaluation

- Matlab code: One-key evaluation is written in [MATLAB code](https://github.com/DengPingFan/CODToolbox), please follow this the instructions in `main.m` and just run it to generate the evaluation results.

### 6. Results download

The prediction results of our WS-SAM are stored on [Baidu Yun](https://pan.baidu.com/s/1osvAanBj8cfWx836zVyfrw?pwd=6666) please check.





## Related Works
[Strategic preys make acute predators: Enhancing camouflaged object detectors by generating camouflaged objects](https://github.com/ChunmingHe/Camouflageator), ICLR 2024.

[Camouflaged object detection with feature decomposition and edge reconstruction](https://github.com/ChunmingHe/FEDER), NeurIPS 2023.

[Segment Anything](https://github.com/facebookresearch/segment-anything), ICCV 2023.

[Concealed Object Detection](https://github.com/GewelsJI/SINet-V2), TPAMI 2022.

You can see more related papers in [Awesome-COS](https://github.com/ChunmingHe/awesome-concealed-object-segmentation).

## ðŸ“Ž Citation

If you find the code helpful in your research or work, please cite the following paper(s).

```
@article{he2023weaklysupervised,
  title={Weakly-Supervised Concealed Object Segmentation with SAM-based Pseudo Labeling and Multi-scale Feature Grouping},
  author={He, Chunming and Li, Kai and Zhang, Yachao and Xu, Guoxia and Tang, Longxiang and Zhang, Yulun and Guo, Zhenhua and Li, Xiu},
  journal={NeurIPS},
  year={2023}
}
```
## Concat
If you have any questions, please feel free to contact me via email at chunminghe19990224@gmail.com or hcm21@mails.tsinghua.edu.cn.

## ðŸ’¡ Acknowledgements
The codes are based on [FEDER](https://github.com/ChunmingHe/FEDER) and [SINet V2](https://github.com/GewelsJI/SINet-V2). Please also follow their licenses. Thanks for the awesome work.

